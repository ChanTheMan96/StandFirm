<div class="container">
  <div class="page-content">
    <ng-container *ngIf="!selectedEmotion">
      <section class="emotion-intro">
        <h1>What are you carrying today?</h1>
        <p>
          Select an emotion or challenge to get practical guidance and relevant
          Scripture.
        </p>
        <span class="emotion-count">{{ emotions.length }} categories</span>
      </section>

      <div nz-row [nzGutter]="[16, 16]" class="emotion-grid">
        <div nz-col [nzXs]="12" [nzSm]="12" [nzMd]="8" *ngFor="let emotion of emotions">
          <nz-card (click)="selectEmotion(emotion.emotion)" [nzHoverable]="true" class="emotion-card">
            <div class="emotion-icon-wrapper">
              <span nz-icon [nzType]="emotion.icon" nzTheme="outline" class="emotion-icon"></span>
            </div>
            <h3 class="emotion-title">{{ emotion.emotion }}</h3>
          </nz-card>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="selectedEmotion && selectedEmotionData">
      <div nz-row [nzGutter]="[24, 24]" class="detail-grid">
        <div nz-col [nzXs]="24">
          <nz-card [nzTitle]="selectedEmotionData.emotion" class="emotion-focus-card">
            <div class="emotion-header">
              <div class="emotion-icon-wrapper large">
                <span nz-icon [nzType]="selectedEmotionData.icon" nzTheme="outline" class="emotion-icon"></span>
              </div>
              <div class="emotion-details">
                <p class="emotion-subline">{{ getEmotionSubline(selectedEmotionData.emotion) }}</p>
                <p class="emotion-description">{{ selectedEmotionData.description }}</p>
              </div>
            </div>
          </nz-card>
        </div>

        <ng-container *ngIf="!showingVerses">
          <div nz-col [nzXs]="24" [nzMd]="12">
            <nz-card nzTitle="Common Challenges" class="detail-panel">
              <div class="problems-list">
                <div class="problem-item" *ngFor="let problem of selectedEmotionData.problems">
                  <span class="problem-bullet" aria-hidden="true"></span>
                  <span>{{ problem }}</span>
                </div>
              </div>
            </nz-card>
          </div>

      <div nz-col [nzXs]="24" [nzMd]="12">
        <nz-card nzTitle="Biblical Guidance" class="guidance-card detail-panel">
          <p nz-p>{{ currentGuidance }}</p>
          <button nz-button nzType="primary" nzBlock (click)="findRelevantVerses()" class="guidance-action-btn">
            <span>Find Relevant Verses</span>
            <span class="arrow" aria-hidden="true">â†’</span>
          </button>
        </nz-card>
      </div>
        </ng-container>

        <ng-container *ngIf="showingVerses">
          <div nz-col [nzXs]="24">
            <nz-card nzTitle="Relevant Scripture" class="detail-panel scripture-panel">
              <div *ngIf="loadingVerses" class="loading-container">
                <nz-spin nzSimple></nz-spin>
                <p>Loading Bible...</p>
              </div>

              <div *ngIf="!loadingVerses" class="text-size-control">
                <div class="control-head"><span class="label">Reading Comfort</span><span class="size-chip">{{ verseTextSize }}px</span></div>
                <nz-slider
                  [nzMin]="14"
                  [nzMax]="24"
                  [nzStep]="1"
                  [(ngModel)]="verseTextSize"
                  (ngModelChange)="onVerseTextSizeChange($event)"
                ></nz-slider>
              </div>

              <div *ngIf="!loadingVerses" class="verses-list" [style.--sidebar-text-size.px]="verseTextSize">
                <nz-alert *ngFor="let verse of selectedEmotionData.relevantVerses" nzType="info" [nzMessage]="verseMessageTpl" [nzDescription]="verse.text" [nzCloseable]="false" class="verse-alert">
                  <ng-template #verseMessageTpl>
                    <div class="verse-header-row">
                      <span class="verse-reference">{{ verse.reference }}</span>
                      <span *ngIf="verse.version" class="verse-version-tag">{{ verse.version }}</span>
                    </div>
                  </ng-template>
                </nz-alert>
              </div>

              <div class="verse-actions" *ngIf="!loadingVerses">
                <button nz-button nzType="primary" nzBlock (click)="findRelevantVerses()" [disabled]="loadingVerses">
                  <span nz-icon nzType="reload" nzTheme="outline"></span>
                  Load More Verses
                </button>
              </div>
            </nz-card>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </div>
</div>
